ğŸ§­ GENEL HEDEF

Drone Tracker uygulamasÄ±nÄ±n, bir MQTT brokerâ€™a baÄŸlanarak gerÃ§ek zamanlÄ± konum ve telemetri verilerini almasÄ±.

âš™ï¸ 1. Gereken Teknolojiler
Katman	Teknoloji	AÃ§Ä±klama
Frontend (React)	React + Vite	Mevcut uygulama (deÄŸiÅŸmeden kalacak)
Realtime Data	MQTT.js	TarayÄ±cÄ± veya Node Ã¼zerinden MQTT baÄŸlantÄ±sÄ±
Broker (Sunucu)	Mosquitto, HiveMQ, veya EMQX	Mesaj sunucusu â€” drone verilerini yÃ¶neten katman
Drone/SimÃ¼latÃ¶r	(gerÃ§ek drone veya script)	MQTT brokerâ€™a konum mesajÄ± yayÄ±nlar (publish)
ğŸ§© 2. MQTT Nedir KÄ±saca?

MQTT (Message Queuing Telemetry Transport),
IoT (Internet of Things) cihazlarÄ± arasÄ±nda hafif, gerÃ§ek zamanlÄ± veri aktarÄ±mÄ± saÄŸlayan bir publishâ€“subscribe protokolÃ¼dÃ¼r.

Publisher (yayÄ±ncÄ±): Drone veya sensÃ¶r

Broker (sunucu): MesajlarÄ± yÃ¶nlendirir

Subscriber (abone): Senin React uygulaman

ğŸ“¡ Ã–rnek konu (topic):

drones/DR-001/telemetry


ğŸ“¦ Ã–rnek mesaj (JSON):

{
  "id": "DR-001",
  "lat": 41.015,
  "lng": 28.979,
  "speed": 42,
  "altitude": 120,
  "status": "online"
}

ğŸª„ 3. MQTT Broker SeÃ§imi
A) Yerel (Local)

Kendi bilgisayarÄ±na kurabilirsin:

# Ã–rnek: Mosquitto kurulumu (Ubuntu)
sudo apt install mosquitto mosquitto-clients
sudo systemctl enable mosquitto
sudo systemctl start mosquitto


Broker Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda genelde ÅŸu portlar aktif olur:

TCP: 1883 (normal baÄŸlantÄ±)

WebSocket: 9001 (tarayÄ±cÄ± baÄŸlantÄ±sÄ± iÃ§in)

B) Bulut TabanlÄ± (Online)

HiÃ§ kurulum yapmadan test etmek iÃ§in:

HiveMQ Public Broker

broker.hivemq.com
port: 8000 (WebSocket)
topic: drones/#


veya EMQX Cloud (Ãœcretsiz Plan)

âš›ï¸ 4. React TarafÄ±nda MQTT BaÄŸlantÄ±sÄ±

Vite tabanlÄ± projene mqtt kÃ¼tÃ¼phanesini ekle:

npm install mqtt

ğŸ§  5. useMQTT Hook (Yeni Hook)

Yeni bir dosya oluÅŸtur:
src/hooks/useMQTT.js

import { useEffect, useState } from 'react'
import mqtt from 'mqtt'

export function useMQTT(brokerUrl, topic) {
  const [client, setClient] = useState(null)
  const [messages, setMessages] = useState([])

  useEffect(() => {
    const client = mqtt.connect(brokerUrl, {
      clientId: 'drone-tracker-' + Math.random().toString(16).substr(2, 8),
      reconnectPeriod: 3000,
    })
    setClient(client)

    client.on('connect', () => {
      console.log('âœ… MQTT baÄŸlÄ±:', brokerUrl)
      client.subscribe(topic)
    })

    client.on('message', (t, payload) => {
      try {
        const msg = JSON.parse(payload.toString())
        setMessages(prev => [...prev.slice(-50), msg]) // son 50 mesajÄ± sakla
      } catch (e) {
        console.error('Mesaj parse hatasÄ±:', e)
      }
    })

    client.on('error', err => console.error('MQTT HatasÄ±:', err))
    return () => client.end()
  }, [brokerUrl, topic])

  return { messages }
}

ğŸ§­ 6. App.jsx Ä°Ã§inde KullanÄ±mÄ±

SimÃ¼lasyon hookâ€™u (useLiveDrones) yerine MQTT hookâ€™unu Ã§aÄŸÄ±r:

import { useMQTT } from './hooks/useMQTT'

export default function App() {
  const { messages } = useMQTT('wss://broker.hivemq.com:8000/mqtt', 'drones/#')

  const drones = messages.reduce((acc, msg) => {
    const idx = acc.findIndex(d => d.id === msg.id)
    if (idx >= 0) acc[idx] = msg
    else acc.push(msg)
    return acc
  }, [])

  return (
    <div className="app">
      {/* aynÄ± arayÃ¼z: MapView, DroneList, DetailsPanel */}
    </div>
  )
}


Bu ÅŸekilde her gelen MQTT mesajÄ± haritadaki drone konumlarÄ±nÄ± gÃ¼nceller.
ArtÄ±k â€œfake hareketâ€ yok â€” veriler doÄŸrudan brokerâ€™dan geliyor ğŸ¯

ğŸ’¡ 7. Test Ä°Ã§in MQTT Publisher (Ã¶rnek)

GerÃ§ek drone yoksa test etmek iÃ§in terminalden mesaj gÃ¶nderebilirsin:

# Mosquitto client kullanÄ±mÄ±:
mosquitto_pub -h broker.hivemq.com -p 1883 -t "drones/DR-001/telemetry" \
-m '{"id":"DR-001","lat":41.015,"lng":28.979,"speed":40,"altitude":120,"status":"online"}'


veya Node.js script ile sÃ¼rekli yayÄ±n yapan basit bir simÃ¼lasyon:

import mqtt from 'mqtt'
const client = mqtt.connect('mqtt://broker.hivemq.com')

setInterval(() => {
  const msg = {
    id: 'DR-001',
    lat: 41.015 + (Math.random() - 0.5) * 0.01,
    lng: 28.979 + (Math.random() - 0.5) * 0.01,
    speed: 30 + Math.random() * 10,
    altitude: 100 + Math.random() * 20,
    status: 'online'
  }
  client.publish('drones/DR-001/telemetry', JSON.stringify(msg))
}, 1000)

ğŸ”’ 8. GÃ¼venlik ve GeliÅŸtirme NotlarÄ±
Konu	AÃ§Ä±klama
ğŸ” GÃ¼venli baÄŸlantÄ± (WSS)	TarayÄ±cÄ±dan baÄŸlanÄ±yorsan mutlaka wss:// kullan
ğŸ§­ Topic isimlendirme	drones/{droneId}/telemetry yapÄ±sÄ± dÃ¼zenli olur
ğŸ§° Veri doÄŸrulama	Mesajlarda lat, lng, altitude kontrolÃ¼ yap
ğŸ“ˆ Performans	Ã‡ok sayÄ±da drone varsa useMemo ile render optimizasyonu yap
ğŸ§© GeliÅŸmiÅŸ senaryo	Drone komutlarÄ±nÄ± gÃ¶ndermek iÃ§in MQTT publish fonksiyonu eklenebilir
ğŸš€ Ã–zet Yol HaritasÄ±
AdÄ±m	AÃ§Ä±klama
1ï¸âƒ£	MQTT broker seÃ§ (Ã¶r. HiveMQ Cloud)
2ï¸âƒ£	React projesine mqtt kÃ¼tÃ¼phanesini ekle
3ï¸âƒ£	useMQTT hookâ€™unu yaz
4ï¸âƒ£	MQTT mesajlarÄ±nÄ± drone listesine baÄŸla
5ï¸âƒ£	Test iÃ§in publisher script veya gerÃ§ek drone kullan
6ï¸âƒ£	Haritada canlÄ± veriyi izle ğŸ¯

Ä°stersen bir sonraki adÄ±mda sana:

ğŸ”§ â€œuseMQTT hookâ€™una publish (komut gÃ¶nderme) Ã¶zelliÄŸi nasÄ±l eklenirâ€
veya
ğŸ“¡ â€œGerÃ§ek drone telemetri formatÄ±nÄ± (Ã¶r. ArduPilot / PX4) MQTTâ€™ye nasÄ±l Ã§evirirsinâ€
gÃ¶sterebilirim.

Hangisini isterdin?